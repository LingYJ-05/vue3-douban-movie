import{_ as P,r as i,u as A,c as y,o as g,a as t,b,K as ee,M as te,F as j,d as I,t as S,J,v as M,g as G,h as W,N as se,O as oe,y as ae,n as X,w as D,G as ne,f as R,j as z,e as F,p as H,L as ce,k as re,T as Y,x as le,z as ie}from"./index-DLCzzkkd.js";import{a as K}from"./movieList-BjU62QpE.js";const ue={class:"search-box"},fe=["placeholder"],he={__name:"search-box",setup(p){const u=i(""),s=i("æœç´¢ç”µå½±/å½±äºº"),f=i(null),h=A();function o(){u.value="",h.push("/")}const n=()=>{if(u.value.trim()){const v=u.value.trim();h.push({name:"search",query:{q:v}}),u.value="",f.value&&setTimeout(()=>{f.value.focus()},100)}};return(v,l)=>(g(),y("div",ue,[l[1]||(l[1]=t("i",{class:"icon-search"},"ğŸ”",-1)),b(t("input",{onKeyup:te(n,["enter"]),type:"text",class:"box",placeholder:s.value,"onUpdate:modelValue":l[0]||(l[0]=k=>u.value=k),ref_key:"inputRef",ref:f},null,40,fe),[[ee,u.value]]),t("span",{class:"cancel",onClick:o},"å–æ¶ˆ")]))}},ve=P(he,[["__scopeId","data-v-19580ea3"]]),de={class:"history-list"},pe=["onClick"],_e={class:"text"},ge=["onClick"],me={class:"no-history"},ye={__name:"history-list",props:{searches:{type:Array,default:()=>[]}},emits:["selected","delete"],setup(p,{emit:u}){const s=u;function f(o){s("selected",o)}function h(o){s("delete",o)}return(o,n)=>(g(),y("div",de,[t("ul",null,[(g(!0),y(j,null,I(p.searches,v=>(g(),y("li",{key:v,onClick:l=>f(v),class:"history-item"},[t("span",_e,S(v),1),t("span",{class:"close",onClick:J(l=>h(v),["stop"])},[...n[0]||(n[0]=[t("i",{class:"icon-close"},"ğŸ—‘ï¸",-1)])],8,ge)],8,pe))),128))]),b(t("div",me,"è¿˜æ²¡æœ‰æœç´¢å†å² å¿«å»æœç´¢å§ :)",512),[[M,!p.searches.length]])]))}},Se=P(ye,[["__scopeId","data-v-51126cca"]]);function B(p,u,s){const f="/v2/movie/search",h=Object.assign({},G,{query:p,start:u,count:s});return W.get(f,{params:h}).then(o=>Promise.resolve(o.data)).catch(o=>(console.log("æœç´¢ç”µå½±å¤±è´¥:",o),Promise.resolve(oe)))}function N(p,u,s){const f="/v2/movie/tag",h=Object.assign({},G,{tag:p,start:u,count:s});return W.get(f,{params:h}).then(o=>Promise.resolve(o.data)).catch(o=>(console.log("æ ‡ç­¾æœç´¢å¤±è´¥:",o),Promise.resolve(se)))}const ke={class:"suggest-wrapper"},be={class:"suggest-list"},xe=["onClick"],$e={class:"item-pic"},Ce=["alt"],we={class:"item-info"},Me={class:"title"},Te={class:"info"},qe={class:"rating"},Re={class:"pubdate"},je={key:0,class:"no-result"},V=20,Ie={__name:"suggest",props:{query:{type:String,default:""},tagSearch:{type:String,default:""}},emits:["select","listScroll"],setup(p,{emit:u}){const s=p,f=u,h=A(),o=ae(),n=i(null),v=i(0),l=i([]),k=i(!0),_=i(!1),Q=i(!1),E=i(!0),x=i(!0);i(!0);const d=i(null),L=()=>{n.value&&n.value.scroll&&n.value.scroll.scrollTo(0,0,200)},w=async()=>{l.value=[],k.value=!0,x.value=!0,v.value=0,n.value&&n.value.scroll&&n.value.scroll.scrollTo(0,0);try{const e=s.tagSearch||s.query,r=await d.value(e,v.value,V);if(!r||!r.subjects){_.value=!0,x.value=!1;return}if(r.subjects.length)_.value=!1;else{_.value=!0;return}l.value=K(r.subjects)}catch(e){console.log("search error",e)}},T=async()=>{if(!(!x.value||k.value)){x.value=!1,v.value+=V;try{const e=s.tagSearch||s.query,r=await d.value(e,v.value,V);r&&r.subjects&&(l.value=l.value.concat(K(r.subjects)),U(r)),x.value=!0}catch(e){x.value=!0,console.log("search error",e)}}},q=e=>{if(!e||!e.length)return"";let r="";for(let $=0;$<e.length;$++)if(e[$].indexOf("ç”µå½±èŠ‚")===-1&&(r=e[$]),e[$].indexOf("ä¸­å›½å¤§é™†")>-1){r=e[$];break}return r?"/"+r:""},a=e=>e===0?"æš‚æ— è¯„åˆ†":e+"åˆ†",c=e=>{e&&e.id?(h.push({path:`/movie/${e.id}`}),o.commit("SET_MOVIE",e),f("select")):console.error("æ— æ³•è·³è½¬åˆ°è¯¦æƒ…é¡µï¼šç”µå½±IDæ— æ•ˆ")},m=()=>{f("listScroll")},O=e=>{try{return!e||typeof e!="string"?"https://via.placeholder.com/80x120?text=Movie+Poster":e.includes("placeholder.com")||e.includes("weserv.nl")?e:"https://images.weserv.nl/?url="+e.replace(/http\w{0,1}:\/\//,"").replace("/img/","/img/w100/")}catch(r){return console.error("å›¾ç‰‡URLå¤„ç†é”™è¯¯:",r),"https://via.placeholder.com/80x120?text=Movie+Poster"}},Z=e=>{console.log("ç”µå½±æµ·æŠ¥åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å ä½å›¾"),e.target.src="https://via.placeholder.com/80x120?text=Movie+Poster"},U=e=>{(!e||!e.subjects||!e.subjects.length||e.start+e.count>=e.total)&&(k.value=!1)};return X(()=>{s.tagSearch?d.value=N:s.query&&(d.value=B),d.value&&(s.tagSearch||s.query)&&w()}),D(()=>[s.tagSearch,s.query],([e,r])=>{e?d.value=N:r&&(d.value=B),d.value&&(e||r)&&w()},{immediate:!0}),D(()=>s.query,e=>{e&&(s.tagSearch||(d.value=B,l.value=[],w()))}),D(()=>s.tagSearch,e=>{e?(d.value=N,l.value=[],w()):s.query&&(d.value=B,l.value=[],w())}),(e,r)=>{const $=ne("lazy");return g(),y("div",ke,[b(t("div",{class:"to-top",onClick:L},[...r[0]||(r[0]=[t("span",null,"è¿”å›é¡¶éƒ¨",-1)])],512),[[M,l.value.length]]),R(re,{class:"suggest",pullup:Q.value,beforeScroll:E.value,onBeforeScroll:m,onScrollEnd:T,ref_key:"suggestRef",ref:n},{default:z(()=>[t("ul",be,[e.item&&typeof e.item=="object"&&e.item.subtype!=="tv"?(g(!0),y(j,{key:0},I(l.value,C=>(g(),y("li",{class:"suggest-item",key:C.id||C.title,onClick:et=>c(C)},[t("div",$e,[b(t("img",{width:"50",height:"70",onError:Z,alt:(C.title||"æœªçŸ¥ç”µå½±")+"æµ·æŠ¥"},null,40,Ce),[[$,O(C.image)]])]),t("div",we,[t("div",Me,S(C.title||"æœªçŸ¥ç”µå½±"),1),t("div",Te,[t("span",qe,S(a(C.rating)),1),t("span",Re,S(q(C.pubdate)),1)])])],8,xe))),128)):F("",!0),l.value.length?(g(),H(ce,{key:1,hasMore:k.value,onLoadMore:e.loadMore},null,8,["hasMore","onLoadMore"])):F("",!0)]),_.value?(g(),y("div",je,"æŠ±æ­‰ï¼Œæš‚æ— æœç´¢ç»“æœ :(")):F("",!0)]),_:1},8,["pullup","beforeScroll"])])}}},Pe=P(Ie,[["__scopeId","data-v-9c3c6abb"]]),Oe={class:"confirm-wrapper"},Be={class:"confirm-content"},Qe={class:"text"},Ee={class:"operate"},Le={__name:"confirm",props:{text:{type:String,default:"ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ"},cancelText:{type:String,default:"å–æ¶ˆ"},confirmText:{type:String,default:"ç¡®å®š"}},emits:["confirm","cancel"],setup(p,{expose:u,emit:s}){const f=s,h=i(!1);function o(){h.value=!0}function n(){h.value=!1}function v(){f("confirm"),n()}function l(){f("cancel"),n()}return u({show:o,hide:n}),(k,_)=>(g(),H(Y,{name:"confirm-fade"},{default:z(()=>[b(t("div",{class:"confirm",onClick:_[0]||(_[0]=J(()=>{},["stop"]))},[t("div",Oe,[t("div",Be,[t("p",Qe,S(p.text),1),t("div",Ee,[t("div",{class:"operate-btn left",onClick:l},S(p.cancelText),1),t("div",{class:"operate-btn confirm-btn",onClick:v},S(p.confirmText),1)])])])],512),[[M,h.value]])]),_:1}))}},De=P(Le,[["__scopeId","data-v-5080c47a"]]),Fe={class:"search"},Ne={class:"fixed-title"},Ve={class:"type"},ze={class:"shortcut-wrapper"},He={class:""},Ke={class:"tag-list"},Ae={class:"douban-tag tag"},Je=["onClick"],Ge={class:"movie-tag tag"},We=["onClick"],Xe={class:"country-tag tag"},Ye=["onClick"],Ze={class:"search-history"},Ue={__name:"search",setup(p){const u=i(null),s=le(),f=i(null),h=i(null),o=i(""),n=i(""),v=["ç»å…¸","è±†ç“£é«˜åˆ†","å†·é—¨ä½³ç‰‡"],l=["å‰§æƒ…","çˆ±æƒ…","å–œå‰§","ç§‘å¹»","åŠ¨ä½œ","æ‚¬ç–‘","æ²»æ„ˆ","é’æ˜¥","æ–‡è‰º"],k=["ä¸­å›½","ç¾å›½","æ—¥æœ¬","éŸ©å›½","è‹±å›½","æ³•å›½","å¾·å›½","æ„å¤§åˆ©","è¥¿ç­ç‰™","æ¾³å¤§åˆ©äºš"],_=i([]);X(()=>{if(s.query&&s.query.q){const a=s.query.q;console.log("ä»è·¯ç”±å‚æ•°è·å–æœç´¢è¯:",a),d(a)}});function Q(){console.log("æ¸…ç©ºæœç´¢å†å²"),_.value=[]}function E(){u.value.show()}function x(){n.value="",o.value=""}function d(a){if(!a||typeof a!="string"||a.trim()===""){console.warn("æ— æ•ˆçš„æœç´¢è¯");return}const c=q(a);c&&!_.value.includes(c)&&(_.value.push(c),n.value=c)}function L(a){_.value=_.value.filter(c=>c!==a)}function w(a){const c=q(a);c&&d(c)}function T(a){const c=q(a);c&&(n.value=c,o.value=c)}function q(a){if(a&&typeof a=="object"&&typeof a.then=="function")return console.warn("æ¥æ”¶åˆ°Promiseå¯¹è±¡ä½œä¸ºæŸ¥è¯¢å‚æ•°ï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨"),"";if(a==null)return"";if(typeof a=="object")try{return JSON.stringify(a)}catch{return String(a)}return String(a).trim()}return(a,c)=>(g(),H(Y,{name:"fade"},{default:z(()=>[t("div",Fe,[b(R(ve,{onQuery:w,tagSearch:o.value,ref_key:"searchBox",ref:h},null,8,["tagSearch"]),[[M,!o.value]]),b(t("div",Ne,[t("span",{class:"back",onClick:x},[...c[0]||(c[0]=[t("span",{class:"icon-back"},"â†",-1)])]),t("span",Ve,[t("span",null,"å…³äº"+S(n.value||"æœç´¢")+"çš„ç”µå½±",1)])],512),[[M,o.value]]),b(t("div",ze,[t("div",He,[t("div",Ke,[t("div",Ae,[(g(),y(j,null,I(v,m=>t("span",{key:m,onClick:O=>T(m)},S(m),9,Je)),64))]),t("div",Ge,[(g(),y(j,null,I(l,m=>t("span",{key:m,onClick:O=>T(m)},S(m),9,We)),64))]),t("div",Xe,[(g(),y(j,null,I(k,m=>t("span",{key:m,onClick:O=>T(m)},S(m),9,Ye)),64))])]),t("div",Ze,[t("h1",{class:"title"},[c[2]||(c[2]=t("span",{class:"text"},"æœç´¢å†å²",-1)),t("span",{class:"clear",onClick:E},[...c[1]||(c[1]=[t("i",{class:"icon-bin"},"ğŸ—‘ï¸",-1)])])]),R(Se,{searches:_.value,onSelected:d,onDelete:L},null,8,["searches"])])])],512),[[M,!n.value]]),b(t("div",{class:ie(["search-result",{"tag-search":o.value}]),ref_key:"searchResult",ref:f},[R(Pe,{query:n.value,"tag-search":o.value},null,8,["query","tag-search"])],2),[[M,n.value]]),R(De,{ref_key:"confirm",ref:u,text:"ç¡®å®šè¦æ¸…ç©ºæœç´¢å†å²å—ï¼Ÿ",confirmBtnText:"æ¸…ç©º",onConfirm:Q},null,512)])]),_:1}))}},ot=P(Ue,[["__scopeId","data-v-f7918cd3"]]);export{ot as default};
