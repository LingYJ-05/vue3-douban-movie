import{_ as J,r as l,w as Q,c as S,o as b,a as s,b as x,F as re,d as ue,e as U,t as y,f as m,S as ie,v as P,L as X,g as Y,h as Z,m as ve,i as he,j as O,k as V,l as R}from"./index-DLCzzkkd.js";import{_ as de}from"./douban-logo-BUIYXnAW.js";import{S as fe}from"./switches-BRLQLFHU.js";const ge={class:"movie-list"},me=["onClick"],pe={key:0,class:"date"},_e={class:"item"},Me={class:"info-img"},Se=["src"],be={class:"info-desc"},ye={class:"title-section"},ke={class:"title"},we={key:0,class:"rating-section"},Ce={class:"director"},xe={class:"casts"},Pe={class:"seen-count"},je={__name:"movie-list",props:{movies:{type:Array,default:function(){return[]}},hasMore:{type:Boolean,default:!0},needDate:{type:Boolean,default:!0},showScore:{type:Boolean,default:!0}},emits:["getHeight","getMap"],setup(v,{emit:p}){const c=v,d=p,r=l([]),n=l([]);function _(o){if(o===0)return!1;var t=c.movies[o].mainland_pubdate||c.movies[o].date,a=c.movies[o-1].mainland_pubdate||c.movies[o-1].date;return t===a}function u(){for(var o={},t=0;t<c.movies.length;t++){var a=c.movies[t].mainland_pubdate||c.movies[t].date||"Êú™Áü•Êó•Êúü";o[a]?o[a].push(c.movies[t]):o[a]=[c.movies[t]]}d("getMap",o)}function i(){r.value=[];var o=0;n.value.forEach(function(t){t&&(o+=t.clientHeight,r.value.push(o))}),d("getHeight",r.value)}function h(o){console.log("Selected movie:",o)}const H=o=>o!==void 0?"https://images.weserv.nl/?url="+o.replace(/http\w{0,1}:\/\//,""):"",T=o=>{console.log("ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•Ôºå‰ΩøÁî®Âç†‰ΩçÂõæ:",o.target.src),o.target.src="https://via.placeholder.com/80x120?text=ÁîµÂΩ±Êµ∑Êä•"};return Q(function(){return c.movies},function(){c.needDate&&setTimeout(function(){u(),i()})}),(o,t)=>(b(),S("div",ge,[s("ul",null,[(b(!0),S(re,null,ue(v.movies,(a,M)=>{var j,k,w;return b(),S("li",{onClick:$=>h(a),ref_for:!0,ref_key:"group",ref:n},[v.needDate&&!_(M)?(b(),S("div",pe,y(a.date),1)):U("",!0),s("div",_e,[s("div",Me,[s("img",{src:H((j=a.images)==null?void 0:j.small),class:"poster",height:"120",width:"80",onError:T},null,40,Se)]),s("div",be,[s("div",ye,[s("p",ke,y(a.title),1),(k=a.rating)!=null&&k.average?(b(),S("div",we,[m(ie,{score:a.rating.average,size:24,showScore:v.showScore},null,8,["score","showScore"])])):U("",!0)]),s("div",Ce,"ÂØºÊºîÔºö"+y(a.directors?(w=a.directors[0])==null?void 0:w.name:"Êú™Áü•"),1),s("div",xe,"‰∏ªÊºîÔºö"+y(a.casts?a.casts.map($=>$.name).join("/"):"Êú™Áü•"),1),s("div",Pe,y(a.collect_count?a.collect_count:"1000200")+"‰∫∫ÁúãËøá",1)])])],8,me)}),256))]),x(m(X,{hasmore:v.hasMore},null,8,["hasmore"]),[[P,v.movies.length]])]))}},W=J(je,[["__scopeId","data-v-4de7564b"]]);function q(v,p){const c="/v2/movie/in_theaters",d=Object.assign({},Y,{start:v,count:p});return Z.get(c,{params:d}).then(r=>Promise.resolve(r.data)).catch(r=>(console.log("Ëé∑ÂèñÁÉ≠Êò†ÁîµÂΩ±Â§±Ë¥•:",r),Promise.resolve(ve)))}function De(v,p){const c="/v2/movie/coming_soon",d=Object.assign({},Y,{start:v,count:p});return Z.get(c,{params:d}).then(r=>Promise.resolve(r.data)).catch(r=>(console.log("Ëé∑ÂèñÂç≥Â∞Ü‰∏äÊò†ÁîµÂΩ±Â§±Ë¥•:",r),Promise.resolve(he)))}const z=De,He={class:"movie-show"},Te={class:"logo"},$e={class:"list-wrapper"},Ie={class:"list-inner"},Ee={class:"list-inner"},Ue={class:"error-tip"},Be={key:0,class:"list-fixed",ref:"fixed"},Le={class:"fixed-title"},I=10,Ae={__name:"movie-show",setup(v){const p=l([{name:"Ê≠£Âú®ÁÉ≠Êò†"},{name:"Âç≥Â∞Ü‰∏äÊò†"}]),c=l(""),d=l(!0),r=l(!0),n=l(!1),_=l(""),u=l([]),i=l([]),h=l(0),H=l(3),T=l(!0),o=l(!0),t=l(null),a=l(!0),M=l(!1),j=l(-1),k=l(0),w=l(0),$=l("");l(0),l({});const K=l(!0),ee=e=>{e.target.src="https://via.placeholder.com/80x120?text=ÁîµÂΩ±Êµ∑Êä•"},te=()=>{_.value="",E(h.value)},le=e=>{h.value=e,E(e),t.value&&t.value.refresh(),t.value&&setTimeout(()=>{t.value.refresh()},20)},B=()=>{if(!n.value)if(n.value=!0,h.value===0){if(!d.value){n.value=!1,t.value&&t.value.scroll&&t.value.scroll.finishPullUp();return}k.value+=I,q(k.value,I).then(e=>{i.value=i.value.concat(e.subjects||[]),C(e),n.value=!1,t.value&&t.value.scroll&&t.value.scroll.finishPullUp()}).catch(e=>{console.error("Âä†ËΩΩÊõ¥Â§öÁîµÂΩ±Â§±Ë¥•:",e),n.value=!1,t.value&&t.value.scroll&&t.value.scroll.finishPullUp()})}else{if(!r.value){n.value=!1,t.value&&t.value.scroll&&t.value.scroll.finishPullUp();return}let e=u.value.length;z(e,I).then(f=>{u.value=u.value.concat(f.subjects||[]),C(f),n.value=!1,t.value&&t.value.scroll&&t.value.scroll.finishPullUp()}).catch(f=>{console.error("Âä†ËΩΩÊõ¥Â§öÂç≥Â∞Ü‰∏äÊò†ÁîµÂΩ±Â§±Ë¥•:",f),n.value=!1,t.value&&t.value.scroll&&t.value.scroll.finishPullUp()})}},L=e=>{j.value=e.detail.y},oe=()=>{R.push("/search")},A=e=>{R.push({name:"movieDetail",params:{id:e.id}})},G=l(null),g=l(0),F=e=>{g.value=e},N=e=>{G.value=e},se=()=>{console.log("ÂºÄÂßãÂä†ËΩΩÊ≠£Âú®ÁÉ≠Êò†ÁöÑÁîµÂΩ±..."),console.log("MSWÂ∫îËØ•Êã¶Êà™Ê≠§ËØ∑Ê±ÇÂπ∂ËøîÂõûÊ®°ÊãüÊï∞ÊçÆ"),q(k.value,I).then(e=>{console.log("Ëé∑ÂèñÊ≠£Âú®ÁÉ≠Êò†ÁöÑÁîµÂΩ±ÊàêÂäü:",e),console.log("ËøôÊòØÊù•Ëá™MSWÁöÑÊ®°ÊãüÊï∞ÊçÆ:",e.subjects&&e.subjects.length>0),i.value=e.subjects||[],console.log("ËÆæÁΩÆhotMoviesÊï∞ÊçÆ:",i.value),C(e),n.value=!1,M.value=!0}).catch(e=>{console.error("Âä†ËΩΩÊ≠£Âú®ÁÉ≠Êò†ÁîµÂΩ±Â§±Ë¥•:",e),setTimeout(()=>{console.log("ËØ∑Ê±ÇÂ§±Ë¥•Ôºå‰ΩøÁî®Â§áÁî®Ê®°ÊãüÊï∞ÊçÆ"),i.value=generateMockMovies("hot"),C({subjects:i.value,total:i.value.length,start:0,count:i.value.length}),_.value="",n.value=!1,M.value=!0},1e3)})},ae=()=>{console.log("ÂºÄÂßãÂä†ËΩΩÂç≥Â∞Ü‰∏äÊò†ÁöÑÁîµÂΩ±..."),z().then(e=>{console.log("Ëé∑ÂèñÂç≥Â∞Ü‰∏äÊò†ÁöÑÁîµÂΩ±ÊàêÂäü:",e),u.value=e.subjects||[],console.log("ËÆæÁΩÆcomingMoviesÊï∞ÊçÆ:",u.value),C(e),n.value=!1,M.value=!0}).catch(e=>{console.error("Âä†ËΩΩÂç≥Â∞Ü‰∏äÊò†ÁîµÂΩ±Â§±Ë¥•:",e),setTimeout(()=>{console.log("ËØ∑Ê±ÇÂ§±Ë¥•Ôºå‰ΩøÁî®Â§áÁî®Ê®°ÊãüÊï∞ÊçÆ"),u.value=generateMockMovies("coming"),C({subjects:u.value,total:u.value.length,start:0,count:u.value.length}),_.value="",n.value=!1,M.value=!0},1e3)})},C=e=>{const f=e?e.subjects||[]:[];(!e||f.length===0||e.start!==void 0&&e.count!==void 0&&e.total!==void 0&&e.start+e.count>=e.total)&&(h.value===0?d.value=!1:r.value=!1)};Q(j,(e,f)=>{if(e||($.value=""),!(!g.value||!G)){if(e>0){w.value=0;return}if(Array.isArray(g.value)&&g.value.length>1){for(let D=0;D<g.value.length-1;D++){let ne=g.value[D],ce=g.value[D+1];if(-e>=ne&&-e<ce){w.value=D;return}}w.value=g.value.length-2}}});const E=e=>{n.value=!0,M.value=!1,e===0?se():e===1&&ae()};return E(h.value),(e,f)=>(b(),S("div",He,[s("div",{class:"go-search",onClick:oe},[s("div",Te,[s("img",{src:de,width:"35",height:"35",alt:"Ë±ÜÁì£logo",onError:ee},null,32)]),f[0]||(f[0]=s("div",{class:"search-content"},[s("span",{class:"icon-search"},"üîç"),s("span",null,"ÁîµÂΩ±/ÂΩ±‰∫∫/Ê†áÁ≠æ")],-1))]),m(fe,{items:p.value,currentIndex:h.value,onSwitch:le},null,8,["items","currentIndex"]),s("div",$e,[x(m(V,{class:"list-scroll",data:i.value,pullup:a.value,probeType:H.value,listenScroll:T.value,onScroll:L,onPullingUp:B,ref_key:"scrollComponent",ref:t},{default:O(()=>[s("div",Ie,[m(W,{movies:i.value,needDate:!1,onGetHeight:F,onGetMap:N,hasMore:d.value,onSelect:A,ref:"list"},null,8,["movies","hasMore"])])]),_:1},8,["data","pullup","probeType","listenScroll"]),[[P,h.value===0]]),x(m(V,{class:"list-scroll",data:u.value,pullup:a.value,probeType:H.value,listenScroll:T.value,onScroll:L,onPullingUp:B,ref_key:"scrollComponent",ref:t},{default:O(()=>[s("div",Ee,[m(W,{movies:u.value,needDate:K.value,onGetHeight:F,onGetMap:N,hasMore:r.value,onSelect:A,ref:"list"},null,8,["movies","needDate","hasMore"])])]),_:1},8,["data","pullup","probeType","listenScroll"]),[[P,h.value===1]]),x(m(X,{fullScreen:o.value,hasMore:n.value},null,8,["fullScreen","hasMore"]),[[P,n.value]]),x(s("div",Ue,[s("p",null,y(_.value),1),s("button",{onClick:te,class:"retry-btn"},"ÈáçËØï")],512),[[P,_.value&&!n.value]])]),c.value?x((b(),S("div",Be,[s("h1",Le,y(c.value),1)],512)),[[P,h.value===1]]):U("",!0)]))}},Oe=J(Ae,[["__scopeId","data-v-a93c65b5"]]);export{Oe as default};
