import{_ as B,s as ae,E as K,g as oe,h as Z,j as ce,k as ne,a as le,l as re}from"./movie-components-BKQ-HfOF.js";import{r,p as G,a as b,o as p,e as s,g as $,w,m as E,z as J,ao as ue,aa as ie,F as j,d as I,t as x,a0 as W,v as R,u as fe,j as X,E as Q,f as ve,b as V,i as N,Z as Y,aB as he}from"./vue-B8eq9zLq.js";import{a as U}from"./vendor-ngrFHoWO.js";import{a as A}from"./movieList-vW7rxt3S.js";const de={class:"search-box"},_e={class:"search-input-container"},pe=["placeholder"],ge={__name:"search-box",setup(h){const u=r(""),t=r("搜索电影/影人"),f=r(null),v=G();function o(){u.value="",v.push("/")}const c=()=>{if(u.value.trim()){const i=u.value.trim();v.push({name:"search",query:{q:i}}),u.value="",f.value&&setTimeout(()=>{f.value.focus()},100)}};return(i,n)=>{const k=K;return p(),b("div",de,[s("div",_e,[$(k,{class:"search-icon"},{default:E(()=>[$(J(ae))]),_:1}),w(s("input",{onKeyup:ie(c,["enter"]),type:"text",class:"box",placeholder:t.value,"onUpdate:modelValue":n[0]||(n[0]=S=>u.value=S),ref_key:"inputRef",ref:f},null,40,pe),[[ue,u.value]])]),s("span",{class:"cancel",onClick:o},"取消")])}}},me=B(ge,[["__scopeId","data-v-a49f5ab4"]]),ye={class:"history-list"},ke=["onClick"],Se={class:"text"},be=["onClick"],xe={class:"no-history"},$e={__name:"history-list",props:{searches:{type:Array,default:()=>[]}},emits:["selected","delete"],setup(h,{emit:u}){const t=u;function f(o){t("selected",o)}function v(o){t("delete",o)}return(o,c)=>{const i=K;return p(),b("div",ye,[s("ul",null,[(p(!0),b(j,null,I(h.searches,n=>(p(),b("li",{key:n,onClick:k=>f(n),class:"history-item"},[s("span",Se,x(n),1),s("span",{class:"close",onClick:W(k=>v(n),["stop"])},[$(i,null,{default:E(()=>[$(J(oe))]),_:1})],8,be)],8,ke))),128))]),w(s("div",xe,"还没有搜索历史 快去搜索吧 :)",512),[[R,!h.searches.length]])])}}},Ce=B($e,[["__scopeId","data-v-10af3a32"]]);function P(h,u,t){const f="/v2/movie/search",v=Object.assign({},Z,{query:h,start:u,count:t});return U.get(f,{params:v}).then(o=>Promise.resolve(o.data)).catch(o=>Promise.resolve(ne))}function H(h,u,t){const f="/v2/movie/tag",v=Object.assign({},Z,{tag:h,start:u,count:t});return U.get(f,{params:v}).then(o=>Promise.resolve(o.data)).catch(o=>Promise.resolve(ce))}const we={class:"suggest-wrapper"},Me={class:"suggest-list"},Re=["onClick"],Te={class:"item-pic"},je=["alt"],Ie={class:"item-info"},Be={class:"title"},Ee={class:"info"},qe={class:"rating"},Pe={class:"pubdate"},Oe={key:0,class:"no-result"},z=20,De={__name:"suggest",props:{query:{type:String,default:""},tagSearch:{type:String,default:""}},emits:["select","listScroll"],setup(h,{emit:u}){const t=h,f=u,v=G(),o=fe(),c=r(null),i=r(0),n=r([]),k=r(!0),S=r(!1),T=r(!1),O=r(!0),M=r(!0);r(!0);const g=r(null),D=()=>{c.value&&c.value.scroll&&c.value.scroll.scrollTo(0,0,200)},C=async()=>{n.value=[],k.value=!0,M.value=!0,i.value=0,c.value&&c.value.scroll&&c.value.scroll.scrollTo(0,0);try{const e=t.tagSearch||t.query,l=await g.value(e,i.value,z);if(!l||!l.subjects){S.value=!0,M.value=!1;return}if(l.subjects.length)S.value=!1;else{S.value=!0;return}const y=l.subjects.filter(a=>a&&typeof a=="object");n.value=A(y)}catch{}},F=async()=>{if(!(!M.value||!k.value)){M.value=!1,i.value+=z;try{const e=t.tagSearch||t.query,l=await g.value(e,i.value,z);if(l&&l.subjects){const y=l.subjects.filter(a=>a&&typeof a=="object");n.value=n.value.concat(A(y)),te(l)}M.value=!0}catch{M.value=!0}}},d=e=>{if(!e||!e.length)return"";let l="";for(let y=0;y<e.length;y++)if(e[y].indexOf("电影节")===-1&&(l=e[y]),e[y].indexOf("中国大陆")>-1){l=e[y];break}return l?"/"+l:""},m=e=>!e||e===0?"暂无评分":e+"分",L=e=>{e&&e.id?(v.push({path:`/movie/${e.id}`}),o.commit("SET_MOVIE",e),f("select")):console.error("无法跳转到详情页：电影ID无效")},_=()=>{console.log("滚动到底部，加载更多")},q=()=>{f("listScroll")},ee=e=>{try{return!e||typeof e!="string"?"https://dummyimage.com/80x120/ccc/fff&text=Movie+Poster":e.includes("dummyimage.com")||e.includes("weserv.nl")?e:"https://images.weserv.nl/?url="+e.replace(/http\w{0,1}:\/\//,"").replace("/img/","/img/w100/")}catch(l){return console.error("图片URL处理错误:",l),"https://dummyimage.com/80x120/ccc/fff&text=Movie+Poster"}},se=e=>{e.target.src="https://dummyimage.com/80x120/ccc/fff&text=Movie+Poster"},te=e=>{(!e||!e.subjects||!e.subjects.length||e.start+e.count>=e.total)&&(k.value=!1)};return X(()=>{t.tagSearch?g.value=H:t.query&&(g.value=P),g.value&&(t.tagSearch||t.query)&&C()}),Q(()=>[t.tagSearch,t.query],([e,l])=>{e?g.value=H:l&&(g.value=P),g.value&&(e||l)&&C()},{immediate:!0}),Q(()=>t.query,e=>{e&&(t.tagSearch||(g.value=P,n.value=[],C()))}),Q(()=>t.tagSearch,e=>{e?(g.value=H,n.value=[],C()):t.query&&(g.value=P,n.value=[],C())}),(e,l)=>{const y=ve("lazy");return p(),b("div",we,[w(s("div",{class:"to-top",onClick:D},[...l[0]||(l[0]=[s("span",null,"返回顶部",-1)])],512),[[R,n.value.length]]),$(le,{class:"suggest",pullup:T.value,beforeScroll:O.value,onBeforeScroll:q,onScrollEnd:F,ref_key:"suggestRef",ref:c},{default:E(()=>[s("ul",Me,[e.item&&typeof e.item=="object"&&e.item.subtype!=="tv"?(p(!0),b(j,{key:0},I(n.value,a=>(p(),b("li",{class:"suggest-item",key:(a==null?void 0:a.id)||(a==null?void 0:a.title)||"unknown",onClick:cs=>L(a)},[s("div",Te,[w(s("img",{width:"50",height:"70",onError:se,alt:((a==null?void 0:a.title)||"未知电影")+"海报"},null,40,je),[[y,ee(a==null?void 0:a.image)]])]),s("div",Ie,[s("div",Be,x((a==null?void 0:a.title)||"未知电影"),1),s("div",Ee,[s("span",qe,x(m(a==null?void 0:a.rating)),1),s("span",Pe,x(d(a==null?void 0:a.pubdate)),1)])])],8,Re))),128)):V("",!0),n.value.length?(p(),N(_,{key:1,hasMore:k.value,onLoadMore:_},null,8,["hasMore"])):V("",!0)]),S.value?(p(),b("div",Oe,"抱歉，暂无搜索结果 :(")):V("",!0)]),_:1},8,["pullup","beforeScroll"])])}}},Fe=B(De,[["__scopeId","data-v-a3fe80ac"]]),Le={class:"confirm-wrapper"},Qe={class:"confirm-content"},Ve={class:"text"},He={class:"operate"},ze={__name:"confirm",props:{text:{type:String,default:"确定要执行此操作吗？"},cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"确定"}},emits:["confirm","cancel"],setup(h,{expose:u,emit:t}){const f=t,v=r(!1);function o(){v.value=!0}function c(){v.value=!1}function i(){f("confirm"),c()}function n(){f("cancel"),c()}return u({show:o,hide:c}),(k,S)=>(p(),N(Y,{name:"confirm-fade"},{default:E(()=>[w(s("div",{class:"confirm",onClick:S[0]||(S[0]=W(()=>{},["stop"]))},[s("div",Le,[s("div",Qe,[s("p",Ve,x(h.text),1),s("div",He,[s("div",{class:"operate-btn left",onClick:n},x(h.cancelText),1),s("div",{class:"operate-btn confirm-btn",onClick:i},x(h.confirmText),1)])])])],512),[[R,v.value]])]),_:1}))}},Ne=B(ze,[["__scopeId","data-v-5080c47a"]]),Ae={class:"search"},Ke={class:"fixed-title"},Ze={class:"type"},Ge={class:"shortcut-wrapper"},Je={class:"tag-list"},We={class:"douban-tag tag"},Xe=["onClick"],Ye={class:"movie-tag tag"},Ue=["onClick"],es={class:"country-tag tag"},ss=["onClick"],ts={class:"search-history"},as={class:"title"},os={__name:"search",setup(h){const u=he(),t=r(null),f=r(null),v=r(null);r(null);const o=r(""),c=r(""),i=r([]),n=["经典","豆瓣高分","冷门佳片"],k=["剧情","爱情","喜剧","科幻","动作","悬疑","治愈","青春","文艺"],S=["中国","美国","日本","韩国","英国","法国","德国","意大利","西班牙","澳大利亚"];X(()=>{u.query.q&&T(u.query.q)});function T(d){if(!(d!=null&&d.trim()))return;const m=String(d).trim();i.value.includes(m)||i.value.push(m),c.value=m}function O(d){i.value=i.value.filter(m=>m!==d)}function M(){i.value=[]}function g(){t.value.show()}function D(d){T(d)}function C(d){c.value=d,o.value=d}function F(){c.value="",o.value="",u.path}return(d,m)=>{const L=re;return p(),N(Y,{name:"fade"},{default:E(()=>[s("div",Ae,[w($(me,{onQuery:D,tagSearch:o.value,ref_key:"searchBox",ref:f},null,8,["tagSearch"]),[[R,!o.value]]),w(s("div",Ke,[s("span",{class:"back",onClick:F},[...m[0]||(m[0]=[s("span",{class:"icon-back"},"←",-1)])]),s("span",Ze,"关于"+x(c.value||"搜索")+"的电影",1)],512),[[R,o.value]]),w(s("div",Ge,[s("div",Je,[s("div",We,[(p(),b(j,null,I(n,_=>s("span",{key:_,onClick:q=>C(_)},x(_),9,Xe)),64))]),s("div",Ye,[(p(),b(j,null,I(k,_=>s("span",{key:_,onClick:q=>C(_)},x(_),9,Ue)),64))]),s("div",es,[(p(),b(j,null,I(S,_=>s("span",{key:_,onClick:q=>C(_)},x(_),9,ss)),64))])]),s("div",ts,[s("h1",as,[m[1]||(m[1]=s("span",{class:"text"},"搜索历史",-1)),s("span",{class:"clear",onClick:g},[$(L,{type:"primary",icon:"Delete"})])]),$(Ce,{searches:i.value,onSelected:T,onDelete:O},null,8,["searches"])])],512),[[R,!c.value]]),w(s("div",{class:"search-result",ref_key:"searchResult",ref:v},[$(Fe,{query:c.value,"tag-search":o.value},null,8,["query","tag-search"])],512),[[R,c.value]]),$(Ne,{ref_key:"confirm",ref:t,text:"确定要清空搜索历史吗？",confirmBtnText:"清空",onConfirm:M},null,512)])]),_:1})}}},is=B(os,[["__scopeId","data-v-bbad33a0"]]);export{is as default};
