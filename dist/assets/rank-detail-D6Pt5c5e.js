import{r as o,c as B,j as V,a as j,e as r,i as S,b as g,g as I,p as z,t as T,m as D,aB as F,u as $,o as y,n as U}from"./vue-B8eq9zLq.js";import{c as W}from"./movieList-vW7rxt3S.js";import{m as q,c as A,d as G,e as H,_ as J,S as K,a as Q,L as X}from"./movie-components-BKQ-HfOF.js";import{R as Y}from"./rank-list-B8LgljMW.js";import"./vendor-ngrFHoWO.js";function L(i,c){return Promise.resolve(q)}function Z(i,c){return Promise.resolve(H)}function ee(i,c){return Promise.resolve(G)}function ae(i,c){return Promise.resolve(A)}const te={class:"rank-wrapper"},se={class:"fixed-title"},ne={class:"type"},oe={style:{color:"red","text-align":"center","font-size":"12px"}},le={__name:"rank-detail",setup(i){const c=F(),h=z(),v=$(),p=o("豆瓣 Top250"),R=o(L),t=o(!0),l=o(0),M=o([{name:"1-50"},{name:"51-100"},{name:"101-150"},{name:"151-200"},{name:"201-250"}]),s=o([]),k=o(!0),d=o(!1),u=o(null),m=B(()=>t.value?s.value[l.value]||[]:s.value[0]||[]),b=()=>h.back("/rank"),C=e=>{e>0&&v.commit("SET_SCROLL_POSITION",e),e===0&&(e=v.state.scrollPosition||0),u.value&&u.value.scrollTo(0,e,300),v.commit("SET_SCROLL_POSITION",e)},O=e=>{l.value=e,s.value[e]||_(e*50,50,e),nextTick(()=>{u.value&&u.value.refresh()})},P=e=>{h.push(`/movie/${e.id}`),v.commit("SET_MOVIE",e)},x=async()=>{var n;if(d.value||!k.value)return;d.value=!0;const e=t.value?l.value*50+m.value.length:((n=s.value[0])==null?void 0:n.length)||0;try{await _(e,10,l.value)}finally{d.value=!1}},_=async(e,n,a)=>{const f=await R.value(e,n),w=W(f.subjects);s.value[a]||(s.value[a]=[]),e===0||!t.value?s.value[a]=w:s.value[a]=[...s.value[a],...w],k.value=f.subjects.length===n&&f.start+f.count<(t.value?50:100)},E=()=>{const e=c.params.rankType,a={top250:{fn:L,name:"豆瓣 Top250",isTop250:!0},weekly:{fn:Z,name:"本周口碑榜",isTop250:!1},new:{fn:ee,name:"新片榜",isTop250:!1},us:{fn:ae,name:"北美票房榜",isTop250:!1}}[e];a&&(R.value=a.fn,p.value=a.name,t.value=a.isTop250)},N=async()=>{await _(0,t.value?50:100,l.value)};return V(()=>{E(),N()}),(e,n)=>(y(),j("div",te,[r("div",se,[r("span",{class:"back",onClick:b},[...n[0]||(n[0]=[r("i",{class:"icon-back"},"←",-1)])]),r("span",ne,T(p.value),1)]),t.value?(y(),S(K,{key:0,switches:M.value,currentIndex:l.value,smallFont:!0,onSwitch:O,style:{"z-index":"200"}},null,8,["switches","currentIndex"])):g("",!0),r("div",oe," isTop250: "+T(t.value)+", rankType: "+T(p.value),1),I(Q,{data:m.value,pullup:!0,probeType:3,listenScroll:!0,onScrollToEnd:x,onScroll:C,class:"rank-list-wrapper",ref_key:"scrollRef",ref:u},{default:D(()=>[r("div",{class:U(["rank-content",{"more-padding":t.value}])},[I(Y,{rankItems:m.value,hasMore:k.value,onSelect:P},null,8,["rankItems","hasMore"])],2),m.value.length?g("",!0):(y(),S(X,{key:0,fullScreen:!0}))]),_:1},8,["data"])]))}},me=J(le,[["__scopeId","data-v-04d8e7cf"]]);export{me as default};
