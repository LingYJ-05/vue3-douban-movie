import{_ as O,s as re,E as Q,x as ue,y as X,z as ie,A as de,B as _e,c as Y,k as fe,j as ve,e as he,C as pe,m as ge,o as me,D as ye}from"./movie-components-BsQqYExX.js";import{r as v,aA as Z,c as C,o as d,a as t,R as u,K as T,J as $,u as L,ai as ke,ah as xe,Q as P,a5 as M,P as w,W as j,S as R,aB as Se,m as U,p as z,I as B,O as K,L as J,T as ee,az as $e,al as Ce}from"./vue-BjCnnM4Q.js";/* empty css                *//* empty css                        */import{a as te}from"./vendor-B9ygI19o.js";const be={class:"search-box"},we={class:"search-input-container"},Ie=["placeholder"],Te={__name:"search-box",setup(g){const r=v(""),o=v("搜索电影/影人"),h=v(null),p=Z();function l(){r.value="",p.push("/")}const i=()=>{if(r.value.trim()){const c=r.value.trim();p.push({name:"search",query:{q:c}}),r.value="",h.value&&setTimeout(()=>{h.value.focus()},100)}};return(c,_)=>{const x=Q;return d(),C("div",be,[t("div",we,[u(x,{class:"search-icon"},{default:$(()=>[u(L(re))]),_:1}),T(t("input",{onKeyup:xe(i,["enter"]),type:"text",class:"box",placeholder:o.value,"onUpdate:modelValue":_[0]||(_[0]=m=>r.value=m),ref_key:"inputRef",ref:h},null,40,Ie),[[ke,r.value]])]),t("span",{class:"cancel",onClick:l},"取消")])}}},Ee=O(Te,[["__scopeId","data-v-581625ca"]]),Re={class:"history-list"},Be=["onClick"],qe={class:"text"},Pe=["onClick"],Me={class:"no-history"},Oe={__name:"history-list",props:{searches:{type:Array,default:()=>[]}},emits:["selected","delete"],setup(g,{emit:r}){const o=r;function h(l){o("selected",l)}function p(l){o("delete",l)}return(l,i)=>{const c=Q;return d(),C("div",Re,[t("ul",null,[(d(!0),C(P,null,M(g.searches,_=>(d(),C("li",{key:_,onClick:x=>h(_),class:"history-item"},[t("span",qe,w(_),1),t("span",{class:"close",onClick:j(x=>p(_),["stop"])},[u(c,null,{default:$(()=>[u(L(ue))]),_:1})],8,Pe)],8,Be))),128))]),T(t("div",Me,"还没有搜索历史 快去搜索吧 :)",512),[[R,!g.searches.length]])])}}},Ae=O(Oe,[["__scopeId","data-v-10af3a32"]]);function A(g,r,o){const h="/v2/movie/search",p=Object.assign({},X,{q:g,start:r,count:o});return te.get(h,{params:p}).then(l=>Promise.resolve(l.data)).catch(l=>(console.log("搜索电影失败:",l),Promise.resolve(de)))}function W(g,r,o){const h="/v2/movie/search",p=Object.assign({},X,{tag:g,start:r,count:o});return te.get(h,{params:p}).then(l=>Promise.resolve(l.data)).catch(l=>(console.log("标签搜索失败:",l),Promise.resolve(ie)))}const De={class:"suggest-wrapper"},Le={key:2,class:"movie-list"},Qe={class:"movie-item"},Ve={class:"item-pic"},Fe={class:"image-slot"},He={class:"item-info"},Ne={class:"title"},ze={class:"info"},Ke={key:1,class:"no-rating"},Je={class:"pubdate"},We={key:1,class:"load-more"},Ge={key:2,class:"no-more"},D=20,Xe={__name:"suggest",props:{query:{type:String,default:""},tagSearch:{type:String,default:""}},emits:["select","listScroll"],setup(g,{emit:r}){const o=g,h=r,p=Z(),l=Se(),i=v(0),c=v([]),_=v(!0),x=v(!1),m=v(!1),I=v(!0),S=v(null),V=()=>{window.scrollTo({top:0,behavior:"smooth"})},E=async()=>{c.value=[],_.value=!0,x.value=!1,i.value=0,m.value=!0;try{const e=o.tagSearch||o.query;if(!e){m.value=!1;return}const n=await S.value(e,i.value,D);if(!n||!n.subjects){x.value=!0,m.value=!1;return}if(n.subjects.length)x.value=!1;else{x.value=!0,m.value=!1;return}const f=n.subjects.filter(s=>s&&typeof s=="object").map(s=>(s.images&&!s.image&&(s.image=s.images.large),s.year&&!s.pubdate&&(s.pubdate=[s.year]),s));c.value=f,b(n)}catch(e){console.error("搜索错误:",e),x.value=!0}finally{m.value=!1}},F=async()=>{if(!(!I.value||!_.value)){I.value=!1;try{const e=o.tagSearch||o.query;if(!e)return;const n=await S.value(e,i.value+D,D);if(n&&n.subjects){const f=n.subjects.filter(s=>s&&typeof s=="object").map(s=>(s.images&&!s.image&&(s.image=s.images.large),s.year&&!s.pubdate&&(s.pubdate=[s.year]),s));c.value=[...c.value,...f],b(n)}}catch(e){console.error("加载更多错误:",e)}finally{I.value=!0,i.value+=D}}},q=e=>{if(!e)return"上映时间未知";if(Array.isArray(e)){let n="";for(let k=0;k<e.length;k++)if(e[k].indexOf("电影节")===-1&&(n=e[k]),e[k].indexOf("中国大陆")>-1){n=e[k];break}return n?"上映时间: "+n:"上映时间未知"}return typeof e=="string"?"上映时间: "+e:"上映时间未知"},H=e=>{e&&e.id?(p.push({path:`/movie/${e.id}`}),l.commit("SET_MOVIE",e),h("select")):console.error("无法跳转到详情页：电影ID无效")},y=e=>{try{return!e||typeof e!="string"?"https://dummyimage.com/80x120/ccc/fff&text=Movie+Poster":e.includes("dummyimage.com")||e.includes("weserv.nl")?e:"https://images.weserv.nl/?url="+e.replace(/http\w{0,1}:\/\//,"").replace("/img/","/img/w100/")}catch(n){return console.error("图片URL处理错误:",n),"https://dummyimage.com/80x120/ccc/fff&text=Movie+Poster"}},b=e=>{!e||!e.subjects||!e.subjects.length||e.start!==void 0&&e.count!==void 0&&e.total!==void 0&&e.start+e.count>=e.total?_.value=!1:_.value=!0};return U(()=>{o.tagSearch?S.value=W:o.query&&(S.value=A),S.value&&(o.tagSearch||o.query)&&E()}),z(()=>[o.tagSearch,o.query],([e,n])=>{e?S.value=W:n&&(S.value=A),S.value&&(e||n)&&E()},{immediate:!0}),z(()=>o.query,e=>{e&&!o.tagSearch&&(S.value=A,E())}),z(()=>o.tagSearch,e=>{e?(S.value=W,E()):o.query&&(S.value=A,E())}),(e,n)=>{const k=Q,f=Y,s=fe,se=ve,ae=he,oe=ge,ne=me,le=ye;return d(),C("div",De,[T(u(f,{class:"to-top-btn",type:"primary",onClick:V},{default:$(()=>[u(k,null,{default:$(()=>[u(L(_e))]),_:1}),n[0]||(n[0]=K(" 返回顶部 ",-1))]),_:1},512),[[R,c.value.length]]),m.value&&!c.value.length?(d(),B(s,{key:0,rows:6,animated:""})):x.value||!c.value.length&&!m.value?(d(),B(se,{key:1,description:"暂无相关电影"})):(d(),C("div",Le,[e.item&&typeof e.item=="object"?(d(!0),C(P,{key:0},M(c.value,(a,ce)=>(d(),B(ne,{key:(a==null?void 0:a.id)||(a==null?void 0:a.title)||"unknown"+ce,"body-style":{padding:"15px"},class:"movie-card",shadow:"hover",onClick:N=>H(a)},{default:$(()=>{var N,G;return[t("div",Qe,[t("div",Ve,[u(ae,{src:y((a==null?void 0:a.image)||((N=a==null?void 0:a.images)==null?void 0:N.large)),fit:"cover",alt:((a==null?void 0:a.title)||"未知电影")+"海报",lazy:""},{error:$(()=>[t("div",Fe,[u(k,null,{default:$(()=>[u(L(pe))]),_:1})])]),_:1},8,["src","alt"])]),t("div",He,[t("h3",Ne,w((a==null?void 0:a.title)||"未知电影"),1),t("div",ze,[(G=a==null?void 0:a.rating)!=null&&G.average?(d(),B(oe,{key:0,value:a.rating.average/2,disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}",class:"rating"},null,8,["value"])):(d(),C("span",Ke,"暂无评分")),t("p",Je,w(q((a==null?void 0:a.pubdate)||(a==null?void 0:a.year))),1)])])])]}),_:2},1032,["onClick"]))),128)):J("",!0),_.value&&c.value.length?(d(),C("div",We,[u(f,{loading:!I.value,onClick:F,type:"primary",plain:""},{default:$(()=>[K(w(I.value?"加载更多":"加载中..."),1)]),_:1},8,["loading"])])):J("",!0),!_.value&&c.value.length?(d(),C("div",Ge,[u(le,null,{default:$(()=>[...n[1]||(n[1]=[K("没有更多了",-1)])]),_:1})])):J("",!0)]))])}}},Ye=O(Xe,[["__scopeId","data-v-3c1ec3b6"]]),Ze={class:"confirm-wrapper"},je={class:"confirm-content"},Ue={class:"text"},et={class:"operate"},tt={__name:"confirm",props:{text:{type:String,default:"确定要执行此操作吗？"},cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"确定"}},emits:["confirm","cancel"],setup(g,{expose:r,emit:o}){const h=o,p=v(!1);function l(){p.value=!0}function i(){p.value=!1}function c(){h("confirm"),i()}function _(){h("cancel"),i()}return r({show:l,hide:i}),(x,m)=>(d(),B(ee,{name:"confirm-fade"},{default:$(()=>[T(t("div",{class:"confirm",onClick:m[0]||(m[0]=j(()=>{},["stop"]))},[t("div",Ze,[t("div",je,[t("p",Ue,w(g.text),1),t("div",et,[t("div",{class:"operate-btn left",onClick:_},w(g.cancelText),1),t("div",{class:"operate-btn confirm-btn",onClick:c},w(g.confirmText),1)])])])],512),[[R,p.value]])]),_:1}))}},st=O(tt,[["__scopeId","data-v-5080c47a"]]),at={class:"search"},ot={class:"fixed-title"},nt={class:"type"},lt={class:"shortcut-wrapper"},ct={class:"tag-list"},rt={class:"douban-tag tag"},ut=["onClick"],it={class:"movie-tag tag"},dt=["onClick"],_t={class:"country-tag tag"},ft=["onClick"],vt={class:"search-history"},ht={class:"title"},pt={__name:"search",setup(g){const r=$e(),o=v(null),h=v(null),p=v(null);v(null);const l=v(""),i=v(""),c=v([]),_=["经典","豆瓣高分","冷门佳片"],x=["剧情","爱情","喜剧","科幻","动作","悬疑","治愈","青春","文艺"],m=["中国","美国","日本","韩国","英国","法国","德国","意大利","西班牙","澳大利亚"];U(()=>{r.query.q&&I(r.query.q)});function I(y){if(!(y!=null&&y.trim()))return;const b=String(y).trim();c.value.includes(b)||c.value.push(b),i.value=b}function S(y){c.value=c.value.filter(b=>b!==y)}function V(){c.value=[]}function E(){o.value.show()}function F(y){I(y)}function q(y){i.value=y,l.value=y}function H(){i.value="",l.value="",r.path}return(y,b)=>{const e=Ce("ArrowLeftBold"),n=Q,k=Y;return d(),B(ee,{name:"fade"},{default:$(()=>[t("div",at,[T(u(Ee,{onQuery:F,tagSearch:l.value,ref_key:"searchBox",ref:h},null,8,["tagSearch"]),[[R,!l.value]]),T(t("div",ot,[t("span",{class:"back",onClick:H},[u(k,{type:"primary",color:"gray"},{default:$(()=>[u(n,null,{default:$(()=>[u(e)]),_:1})]),_:1})]),t("span",nt,"关于"+w(i.value||"搜索")+"的电影",1)],512),[[R,l.value]]),T(t("div",lt,[t("div",ct,[t("div",rt,[(d(),C(P,null,M(_,f=>t("span",{key:f,onClick:s=>q(f)},w(f),9,ut)),64))]),t("div",it,[(d(),C(P,null,M(x,f=>t("span",{key:f,onClick:s=>q(f)},w(f),9,dt)),64))]),t("div",_t,[(d(),C(P,null,M(m,f=>t("span",{key:f,onClick:s=>q(f)},w(f),9,ft)),64))])]),t("div",vt,[t("h1",ht,[b[0]||(b[0]=t("span",{class:"text"},"搜索历史",-1)),t("span",{class:"clear",onClick:E},[u(k,{type:"primary",icon:"Delete"})])]),u(Ae,{searches:c.value,onSelected:I,onDelete:S},null,8,["searches"])])],512),[[R,!i.value]]),T(t("div",{class:"search-result",ref_key:"searchResult",ref:p},[u(Ye,{query:i.value,"tag-search":l.value},null,8,["query","tag-search"])],512),[[R,i.value]]),u(st,{ref_key:"confirm",ref:o,text:"确定要清空搜索历史吗？",confirmBtnText:"清空",onConfirm:V},null,512)])]),_:1})}}},St=O(pt,[["__scopeId","data-v-dc30e4a6"]]);export{St as default};
