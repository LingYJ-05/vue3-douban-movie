import{r as i,p as K,a as y,o as g,e as t,w as b,H as ee,I as te,F as j,d as I,t as S,G,v as M,u as se,j as J,x as D,f as oe,g as R,m as z,b as F,i as N,T as W,z as ae,n as ne}from"./vue-BX9jk9wQ.js";import{_ as P,h as X,i as ce,j as re,L as le,b as ie,k as A}from"./movie-components-DMAopocz.js";import{a as Y}from"./vendor-ngrFHoWO.js";const ue={class:"search-box"},fe=["placeholder"],ve={__name:"search-box",setup(p){const u=i(""),s=i("æœç´¢ç”µå½±/å½±äºº"),f=i(null),v=K();function a(){u.value="",v.push("/")}const n=()=>{if(u.value.trim()){const h=u.value.trim();v.push({name:"search",query:{q:h}}),u.value="",f.value&&setTimeout(()=>{f.value.focus()},100)}};return(h,l)=>(g(),y("div",ue,[l[1]||(l[1]=t("i",{class:"icon-search"},"ğŸ”",-1)),b(t("input",{onKeyup:te(n,["enter"]),type:"text",class:"box",placeholder:s.value,"onUpdate:modelValue":l[0]||(l[0]=k=>u.value=k),ref_key:"inputRef",ref:f},null,40,fe),[[ee,u.value]]),t("span",{class:"cancel",onClick:a},"å–æ¶ˆ")]))}},he=P(ve,[["__scopeId","data-v-19580ea3"]]),de={class:"history-list"},pe=["onClick"],_e={class:"text"},ge=["onClick"],me={class:"no-history"},ye={__name:"history-list",props:{searches:{type:Array,default:()=>[]}},emits:["selected","delete"],setup(p,{emit:u}){const s=u;function f(a){s("selected",a)}function v(a){s("delete",a)}return(a,n)=>(g(),y("div",de,[t("ul",null,[(g(!0),y(j,null,I(p.searches,h=>(g(),y("li",{key:h,onClick:l=>f(h),class:"history-item"},[t("span",_e,S(h),1),t("span",{class:"close",onClick:G(l=>v(h),["stop"])},[...n[0]||(n[0]=[t("i",{class:"icon-close"},"ğŸ—‘ï¸",-1)])],8,ge)],8,pe))),128))]),b(t("div",me,"è¿˜æ²¡æœ‰æœç´¢å†å² å¿«å»æœç´¢å§ :)",512),[[M,!p.searches.length]])]))}},Se=P(ye,[["__scopeId","data-v-51126cca"]]);function O(p,u,s){const f="/v2/movie/search",v=Object.assign({},X,{query:p,start:u,count:s});return Y.get(f,{params:v}).then(a=>Promise.resolve(a.data)).catch(a=>Promise.resolve(re))}function H(p,u,s){const f="/v2/movie/tag",v=Object.assign({},X,{tag:p,start:u,count:s});return Y.get(f,{params:v}).then(a=>Promise.resolve(a.data)).catch(a=>Promise.resolve(ce))}const ke={class:"suggest-wrapper"},be={class:"suggest-list"},xe=["onClick"],$e={class:"item-pic"},Ce=["alt"],we={class:"item-info"},Me={class:"title"},Te={class:"info"},qe={class:"rating"},Re={class:"pubdate"},je={key:0,class:"no-result"},V=20,Ie={__name:"suggest",props:{query:{type:String,default:""},tagSearch:{type:String,default:""}},emits:["select","listScroll"],setup(p,{emit:u}){const s=p,f=u,v=K(),a=se(),n=i(null),h=i(0),l=i([]),k=i(!0),_=i(!1),Q=i(!1),E=i(!0),x=i(!0);i(!0);const d=i(null),L=()=>{n.value&&n.value.scroll&&n.value.scroll.scrollTo(0,0,200)},w=async()=>{l.value=[],k.value=!0,x.value=!0,h.value=0,n.value&&n.value.scroll&&n.value.scroll.scrollTo(0,0);try{const e=s.tagSearch||s.query,r=await d.value(e,h.value,V);if(!r||!r.subjects){_.value=!0,x.value=!1;return}if(r.subjects.length)_.value=!1;else{_.value=!0;return}l.value=A(r.subjects)}catch{}},T=async()=>{if(!(!x.value||k.value)){x.value=!1,h.value+=V;try{const e=s.tagSearch||s.query,r=await d.value(e,h.value,V);r&&r.subjects&&(l.value=l.value.concat(A(r.subjects)),U(r)),x.value=!0}catch{x.value=!0}}},q=e=>{if(!e||!e.length)return"";let r="";for(let $=0;$<e.length;$++)if(e[$].indexOf("ç”µå½±èŠ‚")===-1&&(r=e[$]),e[$].indexOf("ä¸­å›½å¤§é™†")>-1){r=e[$];break}return r?"/"+r:""},o=e=>e===0?"æš‚æ— è¯„åˆ†":e+"åˆ†",c=e=>{e&&e.id?(v.push({path:`/movie/${e.id}`}),a.commit("SET_MOVIE",e),f("select")):console.error("æ— æ³•è·³è½¬åˆ°è¯¦æƒ…é¡µï¼šç”µå½±IDæ— æ•ˆ")},m=()=>{f("listScroll")},B=e=>{try{return!e||typeof e!="string"?"https://via.placeholder.com/80x120?text=Movie+Poster":e.includes("placeholder.com")||e.includes("weserv.nl")?e:"https://images.weserv.nl/?url="+e.replace(/http\w{0,1}:\/\//,"").replace("/img/","/img/w100/")}catch(r){return console.error("å›¾ç‰‡URLå¤„ç†é”™è¯¯:",r),"https://via.placeholder.com/80x120?text=Movie+Poster"}},Z=e=>{e.target.src="https://via.placeholder.com/80x120?text=Movie+Poster"},U=e=>{(!e||!e.subjects||!e.subjects.length||e.start+e.count>=e.total)&&(k.value=!1)};return J(()=>{s.tagSearch?d.value=H:s.query&&(d.value=O),d.value&&(s.tagSearch||s.query)&&w()}),D(()=>[s.tagSearch,s.query],([e,r])=>{e?d.value=H:r&&(d.value=O),d.value&&(e||r)&&w()},{immediate:!0}),D(()=>s.query,e=>{e&&(s.tagSearch||(d.value=O,l.value=[],w()))}),D(()=>s.tagSearch,e=>{e?(d.value=H,l.value=[],w()):s.query&&(d.value=O,l.value=[],w())}),(e,r)=>{const $=oe("lazy");return g(),y("div",ke,[b(t("div",{class:"to-top",onClick:L},[...r[0]||(r[0]=[t("span",null,"è¿”å›é¡¶éƒ¨",-1)])],512),[[M,l.value.length]]),R(ie,{class:"suggest",pullup:Q.value,beforeScroll:E.value,onBeforeScroll:m,onScrollEnd:T,ref_key:"suggestRef",ref:n},{default:z(()=>[t("ul",be,[e.item&&typeof e.item=="object"&&e.item.subtype!=="tv"?(g(!0),y(j,{key:0},I(l.value,C=>(g(),y("li",{class:"suggest-item",key:C.id||C.title,onClick:et=>c(C)},[t("div",$e,[b(t("img",{width:"50",height:"70",onError:Z,alt:(C.title||"æœªçŸ¥ç”µå½±")+"æµ·æŠ¥"},null,40,Ce),[[$,B(C.image)]])]),t("div",we,[t("div",Me,S(C.title||"æœªçŸ¥ç”µå½±"),1),t("div",Te,[t("span",qe,S(o(C.rating)),1),t("span",Re,S(q(C.pubdate)),1)])])],8,xe))),128)):F("",!0),l.value.length?(g(),N(le,{key:1,hasMore:k.value,onLoadMore:e.loadMore},null,8,["hasMore","onLoadMore"])):F("",!0)]),_.value?(g(),y("div",je,"æŠ±æ­‰ï¼Œæš‚æ— æœç´¢ç»“æœ :(")):F("",!0)]),_:1},8,["pullup","beforeScroll"])])}}},Pe=P(Ie,[["__scopeId","data-v-903760b6"]]),Be={class:"confirm-wrapper"},Oe={class:"confirm-content"},Qe={class:"text"},Ee={class:"operate"},Le={__name:"confirm",props:{text:{type:String,default:"ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ"},cancelText:{type:String,default:"å–æ¶ˆ"},confirmText:{type:String,default:"ç¡®å®š"}},emits:["confirm","cancel"],setup(p,{expose:u,emit:s}){const f=s,v=i(!1);function a(){v.value=!0}function n(){v.value=!1}function h(){f("confirm"),n()}function l(){f("cancel"),n()}return u({show:a,hide:n}),(k,_)=>(g(),N(W,{name:"confirm-fade"},{default:z(()=>[b(t("div",{class:"confirm",onClick:_[0]||(_[0]=G(()=>{},["stop"]))},[t("div",Be,[t("div",Oe,[t("p",Qe,S(p.text),1),t("div",Ee,[t("div",{class:"operate-btn left",onClick:l},S(p.cancelText),1),t("div",{class:"operate-btn confirm-btn",onClick:h},S(p.confirmText),1)])])])],512),[[M,v.value]])]),_:1}))}},De=P(Le,[["__scopeId","data-v-5080c47a"]]),Fe={class:"search"},He={class:"fixed-title"},Ve={class:"type"},ze={class:"shortcut-wrapper"},Ne={class:""},Ae={class:"tag-list"},Ke={class:"douban-tag tag"},Ge=["onClick"],Je={class:"movie-tag tag"},We=["onClick"],Xe={class:"country-tag tag"},Ye=["onClick"],Ze={class:"search-history"},Ue={__name:"search",setup(p){const u=i(null),s=ae(),f=i(null),v=i(null),a=i(""),n=i(""),h=["ç»å…¸","è±†ç“£é«˜åˆ†","å†·é—¨ä½³ç‰‡"],l=["å‰§æƒ…","çˆ±æƒ…","å–œå‰§","ç§‘å¹»","åŠ¨ä½œ","æ‚¬ç–‘","æ²»æ„ˆ","é’æ˜¥","æ–‡è‰º"],k=["ä¸­å›½","ç¾å›½","æ—¥æœ¬","éŸ©å›½","è‹±å›½","æ³•å›½","å¾·å›½","æ„å¤§åˆ©","è¥¿ç­ç‰™","æ¾³å¤§åˆ©äºš"],_=i([]);J(()=>{if(s.query&&s.query.q){const o=s.query.q;d(o)}});function Q(){_.value=[]}function E(){u.value.show()}function x(){n.value="",a.value=""}function d(o){if(!o||typeof o!="string"||o.trim()==="")return;const c=q(o);c&&!_.value.includes(c)&&(_.value.push(c),n.value=c)}function L(o){_.value=_.value.filter(c=>c!==o)}function w(o){const c=q(o);c&&d(c)}function T(o){const c=q(o);c&&(n.value=c,a.value=c)}function q(o){if(o&&typeof o=="object"&&typeof o.then=="function")return console.warn("æ¥æ”¶åˆ°Promiseå¯¹è±¡ä½œä¸ºæŸ¥è¯¢å‚æ•°ï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨"),"";if(o==null)return"";if(typeof o=="object")try{return JSON.stringify(o)}catch{return String(o)}return String(o).trim()}return(o,c)=>(g(),N(W,{name:"fade"},{default:z(()=>[t("div",Fe,[b(R(he,{onQuery:w,tagSearch:a.value,ref_key:"searchBox",ref:v},null,8,["tagSearch"]),[[M,!a.value]]),b(t("div",He,[t("span",{class:"back",onClick:x},[...c[0]||(c[0]=[t("span",{class:"icon-back"},"â†",-1)])]),t("span",Ve,[t("span",null,"å…³äº"+S(n.value||"æœç´¢")+"çš„ç”µå½±",1)])],512),[[M,a.value]]),b(t("div",ze,[t("div",Ne,[t("div",Ae,[t("div",Ke,[(g(),y(j,null,I(h,m=>t("span",{key:m,onClick:B=>T(m)},S(m),9,Ge)),64))]),t("div",Je,[(g(),y(j,null,I(l,m=>t("span",{key:m,onClick:B=>T(m)},S(m),9,We)),64))]),t("div",Xe,[(g(),y(j,null,I(k,m=>t("span",{key:m,onClick:B=>T(m)},S(m),9,Ye)),64))])]),t("div",Ze,[t("h1",{class:"title"},[c[2]||(c[2]=t("span",{class:"text"},"æœç´¢å†å²",-1)),t("span",{class:"clear",onClick:E},[...c[1]||(c[1]=[t("i",{class:"icon-bin"},"ğŸ—‘ï¸",-1)])])]),R(Se,{searches:_.value,onSelected:d,onDelete:L},null,8,["searches"])])])],512),[[M,!n.value]]),b(t("div",{class:ne(["search-result",{"tag-search":a.value}]),ref_key:"searchResult",ref:f},[R(Pe,{query:n.value,"tag-search":a.value},null,8,["query","tag-search"])],2),[[M,n.value]]),R(De,{ref_key:"confirm",ref:u,text:"ç¡®å®šè¦æ¸…ç©ºæœç´¢å†å²å—ï¼Ÿ",confirmBtnText:"æ¸…ç©º",onConfirm:Q},null,512)])]),_:1}))}},at=P(Ue,[["__scopeId","data-v-a9cd04bf"]]);export{at as default};
